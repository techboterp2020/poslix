<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="report_invoice_document_gcc_inherited" inherit_id="l10n_gcc_invoice.arabic_english_invoice">
        <xpath expr="//table//tbody[@class='invoice_tbody']//t[1]" position="before">
            <t t-set="sub_total_amount" t-value="0"/>
            <t t-set="discount_total" t-value="0"/>
        </xpath>
        <xpath expr="//table/tbody[@class='invoice_tbody']/t[@t-foreach='lines']" position="inside">
            <t t-if="line.product_id.discount_product">
                <t t-set="discount_total" t-value="discount_total+line.price_subtotal"/>
            </t>
            <t t-if="not line.product_id.discount_product">
                <t t-set="sub_total_amount" t-value="sub_total_amount+line.price_subtotal"/>
            </t>
        </xpath>
        <xpath expr="//table/tbody[@class='invoice_tbody']/t[@t-foreach='lines']/tr" position="attributes">
            <attribute name="t-if">not line.product_id.discount_product</attribute>
        </xpath>
        <xpath expr="//table[@class='table table-sm']/tr[@class='border-black o_subtotal']/td[@class='text-end']"
               position="replace">
            <td class="text-end">
                <span t-esc="sub_total_amount"/>
            </td>
        </xpath>
        <xpath expr="//table[@class='table table-sm']/tr[@class='border-black o_subtotal']" position="after">
            <t t-if="discount_total">
                    <tr class="border-black o_subtotal">
                    <td>
                        <strong>
                            Discount
                            /
                            تخفيض
                        </strong>
                    </td>
                    <td class="text-end">
                        <span t-esc="discount_total * -1"/>
                    </td>
                    </tr>
            </t>
                </xpath>


    </template>
</odoo>